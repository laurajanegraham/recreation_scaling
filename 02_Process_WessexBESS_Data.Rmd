---
title: "Process Wessex BESS data"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE)
```

```{r load_packages}
# Libraries
library(raster)
library(tidyverse)
library(gdalUtils)
library(doParallel)
library(knitr)
library(sf)

# create study site for the WBESS data
# currently based on a 10km resolution. Change if we change the resolutions at all
study_ext <- c(xmin = 3463525, xmax = 3523525, ymin = 3162900, ymax = 3232900)
```

## Wessex BESS recreation visits data

These data were collected using a PPGIS methodology as part of the Wessex BESS project. NB there are more details available (e.g. type of visit). The bounding box for the Wessex BESS area is roughly 75 x 60 km, so the maximum resolution we will use is 25km (although even this is too coarse). 

```{r rec_data}
visits_sf <- st_read("data/response/All_PPGIS_points_LR.shp", quiet = TRUE) %>% 
  st_transform(crs = 3035)

visits_sp <- as(visits_sf, "Spatial")
```

We need to convert from points to raster at the 6 analysis resolutions (NB we won't be using all of them, this is for consistency across studies for now).

```{r rec_rasters}
# loop through the dem files to get rasters for the visits
fnames <- list.files("data/covariates", pattern = "dem_mean", full.names = TRUE)

for(f in fnames) {
  ras <- raster(f)
  ras <- crop(ras, study_ext)
  rln <- res(ras)/1000
  fname <- paste0("data/response/wbess_", rln[1], "km.tif")
  rec_ras <- rasterize(visits_sp, 
                       ras, 
                       'LUCY_FID', 
                       fun=function(x,...)length(x), 
                       filename = fname,
                       overwrite = TRUE)
}
```

## Session Info

```{r session_info}
session <- devtools::session_info()
session[[1]]
session[[2]] %>% kable
```